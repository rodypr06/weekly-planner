<!DOCTYPE html>
<html>
<head>
    <title>Gemini API Test</title>
</head>
<body>
    <h1>Gemini API Test</h1>
    <button id="test-btn">Test Gemini API</button>
    <div id="result"></div>
    
    <script>
        // Load Supabase
        const script = document.createElement('script');
        script.src = '/public/vendor/supabase.js';
        script.onload = () => {
            // Load auth module after Supabase
            const authScript = document.createElement('script');
            authScript.src = '/public/supabase-auth-fixed.js';
            authScript.onload = () => {
                console.log('Scripts loaded');
                
                document.getElementById('test-btn').onclick = async function() {
                    const resultDiv = document.getElementById('result');
                    resultDiv.innerHTML = 'Testing...';
                    
                    try {
                        // Initialize Supabase
                        await window.initializeSupabase();
                        console.log('Supabase initialized');
                        
                        // Check auth
                        const authStatus = await window.SupabaseAuth.checkAuth();
                        console.log('Auth status:', authStatus);
                        
                        if (!authStatus.authenticated) {
                            resultDiv.innerHTML = '<p style="color: red;">Not authenticated. Please log in first.</p>';
                            return;
                        }
                        
                        // Test ApiClient
                        if (!window.ApiClient) {
                            resultDiv.innerHTML = '<p style="color: red;">ApiClient not loaded!</p>';
                            return;
                        }
                        
                        if (!window.ApiClient.callGemini) {
                            resultDiv.innerHTML = '<p style="color: red;">callGemini method not found!</p>';
                            return;
                        }
                        
                        // Make the API call
                        const response = await window.ApiClient.callGemini('Say "Hello test"');
                        console.log('Gemini response:', response);
                        
                        resultDiv.innerHTML = '<p style="color: green;">Success! Response: ' + response + '</p>';
                        
                    } catch (error) {
                        console.error('Test error:', error);
                        resultDiv.innerHTML = '<p style="color: red;">Error: ' + error.message + '</p>';
                    }
                };
            };
            document.head.appendChild(authScript);
        };
        document.head.appendChild(script);
    </script>
</body>
</html>