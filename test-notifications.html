<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Notifications - Weekly Planner</title>
    <link rel="stylesheet" href="/public/vendor/tailwind.min.css">
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .glass-pane {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
    </style>
</head>
<body class="p-8">
    <div class="max-w-2xl mx-auto">
        <div class="glass-pane rounded-xl p-6 text-white">
            <h1 class="text-3xl font-bold mb-6">🔔 Notification Test Page</h1>
            
            <div class="space-y-4">
                <!-- Permission Status -->
                <div class="p-4 bg-white/10 rounded-lg">
                    <h2 class="text-xl font-semibold mb-2">Permission Status</h2>
                    <p id="permissionStatus" class="text-lg">Checking...</p>
                </div>
                
                <!-- Test Buttons -->
                <div class="space-y-2">
                    <button id="requestPermission" class="w-full p-3 bg-indigo-500 hover:bg-indigo-600 rounded-lg transition">
                        Request Notification Permission
                    </button>
                    
                    <button id="testBasic" class="w-full p-3 bg-purple-500 hover:bg-purple-600 rounded-lg transition">
                        Test Basic Notification
                    </button>
                    
                    <button id="testReminder" class="w-full p-3 bg-green-500 hover:bg-green-600 rounded-lg transition">
                        Test Task Reminder (5 seconds)
                    </button>
                    
                    <button id="testActions" class="w-full p-3 bg-blue-500 hover:bg-blue-600 rounded-lg transition">
                        Test Notification with Actions
                    </button>
                </div>
                
                <!-- Test Results -->
                <div class="p-4 bg-white/10 rounded-lg">
                    <h2 class="text-xl font-semibold mb-2">Test Log</h2>
                    <div id="testLog" class="font-mono text-sm space-y-1"></div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // Log function
        function log(message, type = 'info') {
            const logDiv = document.getElementById('testLog');
            const entry = document.createElement('div');
            const timestamp = new Date().toLocaleTimeString();
            const colors = {
                info: 'text-gray-200',
                success: 'text-green-300',
                error: 'text-red-300',
                warning: 'text-yellow-300'
            };
            entry.className = colors[type] || colors.info;
            entry.textContent = `[${timestamp}] ${message}`;
            logDiv.insertBefore(entry, logDiv.firstChild);
        }
        
        // Update permission status
        function updatePermissionStatus() {
            const status = document.getElementById('permissionStatus');
            if (!('Notification' in window)) {
                status.textContent = '❌ Notifications not supported in this browser';
                status.className = 'text-lg text-red-300';
                return;
            }
            
            const permission = Notification.permission;
            if (permission === 'granted') {
                status.textContent = '✅ Notifications enabled';
                status.className = 'text-lg text-green-300';
            } else if (permission === 'denied') {
                status.textContent = '🚫 Notifications blocked';
                status.className = 'text-lg text-red-300';
            } else {
                status.textContent = '❓ Permission not granted yet';
                status.className = 'text-lg text-yellow-300';
            }
        }
        
        // Initial status check
        updatePermissionStatus();
        
        // Request permission
        document.getElementById('requestPermission').addEventListener('click', async () => {
            log('Requesting notification permission...');
            
            try {
                const permission = await Notification.requestPermission();
                log(`Permission result: ${permission}`, permission === 'granted' ? 'success' : 'warning');
                updatePermissionStatus();
            } catch (error) {
                log(`Error requesting permission: ${error.message}`, 'error');
            }
        });
        
        // Test basic notification
        document.getElementById('testBasic').addEventListener('click', () => {
            if (Notification.permission !== 'granted') {
                log('Permission not granted. Please request permission first.', 'warning');
                return;
            }
            
            log('Showing basic notification...');
            
            const notification = new Notification('Test Notification', {
                body: 'This is a basic test notification from Weekly Planner',
                icon: '/icons/icon-192x192.png',
                badge: '/icons/icon-72x72.png'
            });
            
            notification.onclick = () => {
                log('Notification clicked!', 'success');
                notification.close();
            };
        });
        
        // Test reminder notification
        document.getElementById('testReminder').addEventListener('click', () => {
            if (Notification.permission !== 'granted') {
                log('Permission not granted. Please request permission first.', 'warning');
                return;
            }
            
            log('Scheduling reminder in 5 seconds...');
            
            setTimeout(() => {
                log('Showing reminder notification...');
                
                const notification = new Notification('📋 Task Reminder', {
                    body: 'Team meeting - scheduled for 2:00 PM',
                    icon: '/icons/icon-192x192.png',
                    badge: '/icons/icon-72x72.png',
                    tag: 'task-reminder',
                    requireInteraction: true,
                    vibrate: [200, 100, 200]
                });
                
                notification.onclick = () => {
                    log('Reminder notification clicked!', 'success');
                    notification.close();
                };
            }, 5000);
        });
        
        // Test notification with actions
        document.getElementById('testActions').addEventListener('click', async () => {
            if (Notification.permission !== 'granted') {
                log('Permission not granted. Please request permission first.', 'warning');
                return;
            }
            
            log('Showing notification with actions...');
            
            // Check if service worker is available
            if ('serviceWorker' in navigator && navigator.serviceWorker.controller) {
                try {
                    const registration = await navigator.serviceWorker.ready;
                    
                    await registration.showNotification('🎯 Task Due Soon', {
                        body: 'Review pull requests - Due in 15 minutes',
                        icon: '/icons/icon-192x192.png',
                        badge: '/icons/icon-72x72.png',
                        tag: 'task-with-actions',
                        requireInteraction: true,
                        actions: [
                            { action: 'complete', title: '✅ Mark Complete' },
                            { action: 'snooze', title: '⏰ Snooze 10 min' },
                            { action: 'dismiss', title: '❌ Dismiss' }
                        ],
                        data: {
                            taskId: 'test-123',
                            url: window.location.href
                        }
                    });
                    
                    log('Notification with actions shown via service worker', 'success');
                } catch (error) {
                    log(`Error showing notification: ${error.message}`, 'error');
                }
            } else {
                log('Service worker not available. Showing basic notification instead.', 'warning');
                
                const notification = new Notification('🎯 Task Due Soon', {
                    body: 'Review pull requests - Due in 15 minutes (actions not supported)',
                    icon: '/icons/icon-192x192.png',
                    badge: '/icons/icon-72x72.png',
                    requireInteraction: true
                });
            }
        });
        
        // Listen for service worker messages
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.addEventListener('message', (event) => {
                log(`Service worker message: ${event.data.type}`, 'info');
                
                switch (event.data.type) {
                    case 'complete-task':
                        log(`Task marked complete: ${event.data.taskId}`, 'success');
                        break;
                    case 'snooze-reminder':
                        log(`Reminder snoozed for ${event.data.minutes} minutes: ${event.data.taskId}`, 'success');
                        break;
                }
            });
        }
        
        // Check service worker status
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.ready.then(registration => {
                if (registration.active) {
                    log('Service worker is active and ready', 'success');
                } else {
                    log('Service worker is not active', 'warning');
                }
            });
        } else {
            log('Service workers not supported in this browser', 'error');
        }
    </script>
</body>
</html>